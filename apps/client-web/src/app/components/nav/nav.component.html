<div class="mobile-toolbar">
  <p-toolbar appNavToolbar>
    <div class="mobile-toolbar__items">
      <p-button
        appNavButton
        size="large"
        icon="pi pi-bars"
        (onClick)="toggleNavigation()"
      />
      <p-button
        appNavButton
        size="large"
        routerLink="/browse"
        routerLinkActive="active"
        [queryParams]="null"
        [state]="{}"
        icon="pi pi-search"
      />
      <p-button
        appNavButton
        size="large"
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        [queryParams]="null"
        [state]="{}"
        icon="pi pi-home"
      />
      <p-button
        appNavButton
        size="large"
        routerLink="/account"
        icon="pi pi-user"
      />
      <lib-cart-sidebar />
    </div>
  </p-toolbar>
</div>

<p-sidebar appSidebarLeft [(visible)]="isOpen" [blockScroll]="true">
  <ng-template pTemplate="header">
    <a routerLink="/" [queryParams]="null" class="nav__links_logo">
      <span class="nav__links_logo_name">Story</span>
      <span class="nav__links_logo_name">Stash</span>
    </a>
  </ng-template>
  <div class="sidebar">
    <ng-container [ngTemplateOutlet]="links" />
  </div>
</p-sidebar>

<aside class="aside" [@slideInOut]="isExpanded() ? 'in' : 'out'">
  <nav class="nav">
    <div class="nav__links">
      <div class="logo">
        @if (isLabelShowed()) {
          <a routerLink="/" [queryParams]="null" class="nav__links_logo">
            <span class="nav__links_logo_name">Story</span>
            <span class="nav__links_logo_name">Stash</span>
          </a>
        } @else {
          <p-button
            appNavButton
            routerLink="/"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
            icon="pi pi-home"
          />
        }
      </div>
      <p-divider />
      <ul class="items">
        <p-button
          appNavButton
          routerLink="/browse"
          [queryParams]="null"
          routerLinkActive="active"
          [state]="{}"
          icon="pi pi-search"
          [label]="isLabelShowed() ? 'Browse' : ''"
        />
        <ng-container [ngTemplateOutlet]="links" />
      </ul>
    </div>

    <div class="nav__footer">
      <lib-cart-sidebar [isLabelShowed]="isLabelShowed()" />
      @if (isAuthenticated()) {
        <p-button
          appNavButton
          routerLink="/account"
          icon="pi pi-user"
          [label]="isLabelShowed() ? 'Account' : ''"
        />
        <p-button
          appNavButton
          (onClick)="logout()"
          icon="pi pi-sign-out"
          [label]="isLabelShowed() ? 'Log out' : ''"
        />
      } @else {
        <p-button
          appNavButton
          routerLink="/login"
          icon="pi pi-sign-in"
          [label]="isLabelShowed() ? 'Log in' : ''"
        />
        <p-button
          appNavButton
          routerLink="/register"
          icon="pi pi-user-plus"
          [label]="isLabelShowed() ? 'Register' : ''"
        />
      }
      <p-divider />
      <div class="footer">
        <div class="menu" [ngClass]="{ 'expanded-menu': isLabelShowed() }">
          @if (isLabelShowed()) {
            <span>Light</span>
          }
          <p-inputSwitch [(ngModel)]="theme" (onChange)="toggleDarkMode()" />
          @if (isLabelShowed()) {
            <span>Dark</span>
          }
        </div>
        <p-button
          appNavButton
          class="expand-collapse-button"
          (onClick)="expandCollapseNavigation()"
          [icon]="isExpanded() ? 'pi pi-arrow-left' : 'pi pi-arrow-right'"
        />
      </div>
    </div>
  </nav>
</aside>

<ng-template #links>
  @if (isAccountRouteActive()) {
    @for (menuItem of menuItems(); track menuItem.label) {
      <p-button
        appNavButton
        [routerLink]="menuItem.routerLink"
        routerLinkActive="active"
        [queryParams]="null"
        [icon]="menuItem.icon"
        [label]="isLabelShowed() ? menuItem.label : ''"
        (onClick)="isOpen.set(false)"
      />
    }
  } @else {
    @for (category of categories(); track category.id) {
      <p-button
        appNavButton
        class="category"
        routerLink="/browse"
        [queryParams]="{
          categories: category.name.toLowerCase().split(' ').join('_'),
        }"
        [label]="isLabelShowed() ? category.name : category.name[0]"
        [state]="{ category: stringifyCategory(category) }"
        (onClick)="isOpen.set(false)"
      />
    }
  }
</ng-template>
